_target_: cyto_dl.datamodules.dataframe.DataframeDatamodule

path:
cache_dir:

num_workers: 0
batch_size: 1
pin_memory: True
split_column:
columns:
  - ${source_col}
  - ${target_col}

transforms:
  train:
    _target_: monai.transforms.Compose
    transforms:
      # channels are [blank, membrane,blank, structure, nuclear dye, brightfield ]
      # target is the nuclear dyeimage
      - _target_: monai.transforms.LoadImaged
        keys: ${target_col}
        reader:
          - _target_: cyto_dl.image.io.MonaiBioReader
            dimension_order_out: "ZYX"
            C: 4
      # channels are [nucseg, cellseg, nuclear boundary seg, cell boundary seg]
      # source image is the segmentation
      - _target_: monai.transforms.LoadImaged
        keys: ${source_col}
        reader:
          - _target_: cyto_dl.image.io.MonaiBioReader
            dimension_order_out: "ZYX"
            C: 0
      - _target_: monai.transforms.AddChanneld
        keys: ${data.columns}
      - _target_: cyto_dl.image.transforms.Resized
        keys:
          - ${source_col}
          - ${target_col}
        scale_factor: 0.25
        spatial_dims: ${spatial_dims}
      - _target_: monai.transforms.ToTensord
        keys: ${data.columns}
      # GANs use Tanh as final activation, target has to be in range [-1,1]
      - _target_: monai.transforms.ScaleIntensityRangePercentilesd
        keys: ${target_col}
        lower: 0.01
        upper: 99.99
        b_min: -1
        b_max: 1
        clip: True
      # input to synthetic image generation model is a semantic segmentation
      - _target_: monai.transforms.ThresholdIntensityd
        keys: ${source_col}
        threshold: 0.1
        above: False
        cval: 1
      - _target_: cyto_dl.image.transforms.RandomMultiScaleCropd
        keys: ${data.columns}
        patch_shape: ${data._aux.patch_shape}
        patch_per_image: 1
        scales_dict: ${kv_to_dict:${data._aux._scales_dict}}

  test:
    _target_: monai.transforms.Compose
    transforms:
      # channels are [blank, membrane,blank, structure, nuclear dye, brightfield ]
      # target is the nuclear dyeimage
      - _target_: monai.transforms.LoadImaged
        keys: ${target_col}
        reader:
          - _target_: cyto_dl.image.io.MonaiBioReader
            dimension_order_out: "ZYX"
            C: 4
      # channels are [nucseg, cellseg, nuclear boundary seg, cell boundary seg]
      # source image is the segmentation
      - _target_: monai.transforms.LoadImaged
        keys: ${source_col}
        reader:
          - _target_: cyto_dl.image.io.MonaiBioReader
            dimension_order_out: "ZYX"
            C: 0
      - _target_: monai.transforms.AddChanneld
        keys: ${data.columns}
      - _target_: cyto_dl.image.transforms.Resized
        keys:
          - ${source_col}
          - ${target_col}
        scale_factor: 0.25
        spatial_dims: ${spatial_dims}
      - _target_: monai.transforms.ToTensord
        keys: ${data.columns}
      # GANs use Tanh as final activation, target has to be in range [-1,1]
      - _target_: monai.transforms.ScaleIntensityRangePercentilesd
        keys: ${target_col}
        lower: 0.01
        upper: 99.99
        b_min: -1
        b_max: 1
        clip: True
      # input to synthetic image generation model is a semantic segmentation
      - _target_: monai.transforms.ThresholdIntensityd
        keys: ${source_col}
        threshold: 0.1
        above: False
        cval: 1

  predict:
    _target_: monai.transforms.Compose
    transforms:
      # channels are [nucseg, cellseg, nuclear boundary seg, cell boundary seg]
      # source image is the segmentation
      - _target_: monai.transforms.LoadImaged
        keys: ${source_col}
        reader:
          - _target_: cyto_dl.image.io.MonaiBioReader
            dimension_order_out: "ZYX"
            C: 0
      - _target_: monai.transforms.AddChanneld
        keys: ${source_col}
      - _target_: cyto_dl.image.transforms.Resized
        keys:
          - ${source_col}
        scale_factor: 0.25
        spatial_dims: ${spatial_dims}
      - _target_: monai.transforms.ToTensord
        keys: ${source_col}
      # input to synthetic image generation model is a semantic segmentation
      - _target_: monai.transforms.ThresholdIntensityd
        keys: ${source_col}
        threshold: 0.1
        above: False
        cval: 1

  valid:
    _target_: monai.transforms.Compose
    transforms:
      # channels are [blank, membrane,blank, structure, nuclear dye, brightfield ]
      # target is the nuclear dyeimage
      - _target_: monai.transforms.LoadImaged
        keys: ${target_col}
        reader:
          - _target_: cyto_dl.image.io.MonaiBioReader
            dimension_order_out: "ZYX"
            C: 4
      # channels are [nucseg, cellseg, nuclear boundary seg, cell boundary seg]
      # source image is the segmentation
      - _target_: monai.transforms.LoadImaged
        keys: ${source_col}
        reader:
          - _target_: cyto_dl.image.io.MonaiBioReader
            dimension_order_out: "ZYX"
            C: 0
      - _target_: monai.transforms.AddChanneld
        keys: ${data.columns}
      - _target_: cyto_dl.image.transforms.Resized
        keys:
          - ${source_col}
          - ${target_col}
        scale_factor: 0.25
        spatial_dims: ${spatial_dims}
      - _target_: monai.transforms.ToTensord
        keys: ${data.columns}
      # GANs use Tanh as final activation, target has to be in range [-1,1]
      - _target_: monai.transforms.ScaleIntensityRangePercentilesd
        keys: ${target_col}
        lower: 0.01
        upper: 99.99
        b_min: -1
        b_max: 1
        clip: True
      # input to synthetic image generation model is a semantic segmentation
      - _target_: monai.transforms.ThresholdIntensityd
        keys: ${source_col}
        threshold: 0.1
        above: False
        cval: 1
      - _target_: cyto_dl.image.transforms.RandomMultiScaleCropd
        keys: ${data.columns}
        patch_shape: ${data._aux.patch_shape}
        patch_per_image: 1
        scales_dict: ${kv_to_dict:${data._aux._scales_dict}}

_aux:
  patch_shape: [32, 512, 512]
  _scales_dict:
    - - ${target_col}
      - [1]
    - - ${source_col}
      - [1]
